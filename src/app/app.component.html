<div class="app-container">
  <header class="hero">
    <h1 class="title">ğŸš€ {{ title }}</h1>
    <p class="subtitle">Welcome to your Angular application!</p>
  </header>

  <main class="content">
    <!-- Firestore Test Card -->
    <div class="card firestore-card">
      <h2>ğŸ”¥ Firestore Database Test</h2>
      <p>Test saving and retrieving data from Firebase Firestore for CI/CD pipeline testing.</p>

      @if (firestoreError()) {
        <div class="error-message">
          âš ï¸ {{ firestoreError() }}
        </div>
      }

      <!-- Save Data Form -->
      <div class="save-form">
        <h3>ğŸ’¾ Save Data</h3>
        <div class="form-row">
          <input 
            type="text" 
            placeholder="Enter a message" 
            [value]="newMessage()"
            (input)="newMessage.set($any($event.target).value)"
            class="form-input"
            [disabled]="firestoreLoading()">
          <input 
            type="number" 
            placeholder="Value" 
            [value]="newValue()"
            (input)="newValue.set(+$any($event.target).value)"
            class="form-input form-input-number"
            [disabled]="firestoreLoading()">
          <button 
            class="btn btn-primary" 
            (click)="saveData()" 
            [disabled]="firestoreLoading() || !newMessage().trim()">
            @if (firestoreLoading()) {
              <span class="spinner"></span> Saving...
            } @else {
              Save
            }
          </button>
        </div>
      </div>

      <!-- Data List -->
      <div class="data-section">
        <h3>ğŸ“Š Stored Data ({{ dataCount() }} items)</h3>
        @if (firestoreLoading() && testData().length === 0) {
          <div class="loading-message">
            <span class="spinner"></span> Loading data...
          </div>
        }
        @if (testData().length === 0 && !firestoreLoading()) {
          <p class="no-data">No data yet. Save some data to get started!</p>
        }
        @if (testData().length > 0) {
          <div class="data-list">
            @for (item of testData(); track item.id) {
              <div class="data-item">
                <div class="data-content">
                  <p class="data-message">{{ item.message }}</p>
                  <div class="data-meta">
                    <span class="data-value">Value: {{ item.value }}</span>
                    <span class="data-time">{{ item.timestamp | date:'short' }}</span>
                  </div>
                </div>
              </div>
            }
          </div>
        }
      </div>
    </div>

    <!-- API User Card -->
    <div class="card user-card">
      <h2>ğŸ² Random User from API</h2>
      <p>Fetch a random user from the Firebase Cloud Functions backend.</p>
      
      <button 
        class="btn btn-primary fetch-btn" 
        (click)="fetchRandomUser()" 
        [disabled]="apiLoading()">
        @if (apiLoading()) {
          <span class="spinner"></span> Loading...
        } @else {
          Fetch Random User
        }
      </button>

      @if (apiError()) {
        <div class="error-message">
          âš ï¸ {{ apiError() }}
        </div>
      }

      @if (apiUser()) {
        <div class="user-display">
          <div class="user-avatar">{{ apiUser()!.avatar }}</div>
          <div class="user-info">
            <h3>{{ apiUser()!.name }}</h3>
            <p class="user-role">{{ apiUser()!.role }}</p>
            <p class="user-email">{{ apiUser()!.email }}</p>
          </div>
        </div>
      }
    </div>

    <!-- Get Started Card -->
    <div class="card">
      <h2>Get Started</h2>
      <p>Edit <code>src/app/app.component.html</code> to customize this page.</p>
      <div class="actions">
        <a href="https://angular.dev" target="_blank" class="btn btn-secondary">
          Angular Docs
        </a>
      </div>
    </div>
  </main>

  <router-outlet />
</div>
